<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Homepage | UR'Plan</title>
    <!--Setting the core Bootstrap CSS-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"> 
    <link href="../static/student.css" rel="stylesheet">
    <link rel='icon' href='../static/ucr.ico' type='image/x-icon'/>
</head>
<body class="text-center">    
    <nav class="navbar fixed-top navbar-light" style="background-color:rgba(202, 229, 255, 0.8);">
        <div class="container-fluid" style="display:flex; justify-content: space-between;">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">
                <img src="../static/urplan.png" width="30" height="30" class="d-inline-block align-top" alt="">
                UR'Plan
            </a>
          </div>
          <div class="navbar-text">
            <h1 id="welcome" style="color:#585757; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; font-size: 25px; font-weight: bold;"></h1>
          </div>
          <div class="right">
            <button class="btn btn-outline-primary" type="button" id="signoutButton">Sign Out</button>
          </div>
        </div>
    </nav>
    
    <div id="myResourcesNav" class="leftsidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeResourcesNav()">&times;</a>
        <p-big>Resources</p-big><br>
        <a href="https://student.engr.ucr.edu/majors">Recommended Course Plans</a>
        <a href="https://www1.cs.ucr.edu/undergraduate/course-listings/">Course Offerings</a>
        <a href="http://studentbcoe.ucr.acsitefactory.com/sites/g/files/rcwecm1536/files/2019-06/Breadth%20Requirements%206.12.19.pdf">Breadth Courses</a>
        <a href="https://degreeworks.ucr.edu/dashboard/dashboard">Degree Audit</a>
    </div>

    <div id="myPreferencesNav" class="rightsidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closePreferencesNav()">&times;</a>
        <p-big>Preferences</p-big><br>
        
        <p>Days</p>
        <form>
            <input type="checkbox" id="monday" name="monday" value="M">
            <label for="monday">Monday</label><br>
            <input type="checkbox" id="tuesday" name="tuesday" value="T">
            <label for="tuesday">Tuesday</label><br>
            <input type="checkbox" id="wednesday" name="wednesday" value="W">
            <label for="wednesday">Wednesday</label><br>
            <input type="checkbox" id="thursday" name="thursday" value="R">
            <label for="thursday">Thursday</label><br>
            <input type="checkbox" id="friday" name="friday" value="F">
            <label for="friday">Friday</label><br>
        </form> 
        
        <p>Time</p>
        <form> 
            <label for="startTime">Starting Time: </label>
            <input type="time" id="startTime" value="07:00"><br>
            <label for="endTime">Ending Time: </label>
            <input type="time" id="endTime" value="22:00"><br>
        </form>
        
        <p>Number of Classes</p>
        <form> <!--action="/action_page.php"-->
            <label for="quantity">Quantity: </label>
            <input type="number" id="quantity" name="quantity" min="1" max="5" value="4"><br><br><br>
        </form>

        <input type="submit" onclick="createCalendar()" value="Generate my Term Plan!">
    </div>

    <!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
    <div id="main">
        <button class="btn btn-secondary" type="submit" onclick="openResourcesNav()">Resources</button>
        <button class="btn btn-secondary" type="submit" onclick="openPreferencesNav()">Preferences</button>      
        <iframe id="calendar" src="" style="border-width:0;" width="100%" height="600" frameborder="0" scrolling="no"></iframe>
    </div>

    <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>

    <script>
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: "AIzaSyDz0gR_sgfUeTuXEfkCn5t79qYhBO1hakI",
                clientId: "302327930081-ijcupmhamhanidi156eh0gmjq4idr650.apps.googleusercontent.com",
                discoveryDocs: [
                    "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest",
                ],
                scope: "https://www.googleapis.com/auth/calendar"
            }).then(function () {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                signoutButton.onclick = handleSignOut;
            }, function(error) {
                console.log(JSON.stringify(error, null, 2));
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                var pre = document.getElementById('welcome');
                var textContent = document.createTextNode('Welcome ' + gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName() + '!\n');
                pre.prepend(textContent);
                
                embedCalendars();
            } else {
                //do nothing for now.
            }
        }

        function handleSignOut(event) {
            gapi.auth2.getAuthInstance().signOut();
            location.assign("index");
        }
    
    </script>

    <script>
        /* Set the width of the side navigation to 250px and the left margin of the page content to 250px */
        function openResourcesNav() {
            document.getElementById("myResourcesNav").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
        }

        function closeResourcesNav() {
            document.getElementById("myResourcesNav").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
        }

        function openPreferencesNav() {
            document.getElementById("myPreferencesNav").style.width = "250px";
            document.getElementById("main").style.marginRight = "250px";
        }

        function closePreferencesNav() {
            document.getElementById("myPreferencesNav").style.width = "0";
            document.getElementById("main").style.marginRight = "0";
        }

        function embedCalendars() {            
            var calendarIdsString = "";
            
            gapi.client.calendar.calendarList.list({
                // use default parameters
            }).then(function(response) {
                var calendars = response.result.items;
                if (calendars.length > 0) { 
                    for (i = 0; i < calendars.length; i++) {
                        var calendar = calendars[i];
                        calendarIdsString += "&src=" + calendar.id + "&amp;&color=" + calendar.backgroundColor + "&amp;";
                    }
                    calendarIdsString = calendarIdsString.replace(/@/g, '%40');
                    calendarIdsString = calendarIdsString.replace(/#/g, '%23');
                    document.getElementById("calendar").src = "https://www.google.com/calendar/embed?" + calendarIdsString + "&ctz=America%2FLosAngeles&amp;&mode=WEEK"; //colors?
                } else {
                    // document.getElementById("calendar").src = "https://www.google.com/calendar";
                }
            });
        }  

        function createCalendar() {
            gapi.client.calendar.calendars.insert({
                "resource": {
                    "summary": "Spring 2020 Classes"
                }
            })
            .then(function(response) {
                embedCalendars();

                var pre = document.getElementById('main');
                var instruction1 = document.createTextNode("Click your desired classes and/or sections to display them.");
                pre.appendChild(instruction1);
                var newline1 = document.createElement('br');
                pre.appendChild(newline1);
                var instruction2 = document.createTextNode("Courses can then be copied to your R'Calendar by clicking on the generated Google Calendar event.");
                pre.appendChild(instruction2);
                var newline2 = document.createElement('br');
                pre.appendChild(newline2);                

                var a = document.createElement('a');
                var classLink = document.createTextNode("CS 141 Lecture T,R 13:00-14:30PM");
                a.appendChild(classLink);
                a.href = "javascript:void(0)";
                a.onclick = function() {
                    gapi.client.calendar.events.insert({
                        "calendarId": response.result.id,
                        "resource": {
                            "summary": "CS 141 Lecture",
                            "start": {
                                "dateTime": "2020-03-17T13:00:00",
                                "timeZone": "America/Los_Angeles"
                            },
                            "end": {
                                "dateTime": "2020-03-17T14:30:00",
                                "timeZone": "America/Los_Angeles"
                            },
                            "recurrence": [
                                "RRULE:FREQ=WEEKLY;UNTIL=20200320T220000Z;BYDAY=TU,TH"
                            ]
                        }
                    })
                    .then(function(response) {
                        embedCalendars();
                    });
                }
                pre.appendChild(a);

            });
        }   
        
    </script>

</body>
</html>